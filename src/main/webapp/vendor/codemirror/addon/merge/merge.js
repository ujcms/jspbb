!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","diff_match_patch"],e):e(CodeMirror)}(function(p){"use strict";var A=p.Pos,k="http://www.w3.org/2000/svg";function C(e,t){this.mv=e,this.type=t,this.classes="left"==t?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}function h(e){e.diffOutOfDate&&(e.diff=O(e.orig.getValue(),e.edit.getValue(),e.mv.options.ignoreWhitespace),e.chunks=x(e.diff),e.diffOutOfDate=!1,p.signal(e.edit,"updateDiff",e.diff))}var f=!(C.prototype={constructor:C,init:function(e,t,i){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=p(e,P({value:t,readOnly:!this.mv.options.allowEditingOriginals},P(i))),"align"==this.mv.options.connect&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new Q(this.edit)),this.orig.state.trackAlignable=new Q(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.orig.state.diffViews=[this];var r=i.chunkClassLocation||"background";"[object Array]"!=Object.prototype.toString.call(r)&&(r=[r]),this.classes.classLocation=r,this.diff=O(n(t),n(i.value),this.mv.options.ignoreWhitespace),this.chunks=x(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=!1!==i.showDifferences},registerEvents:function(e){this.forceUpdate=function(i){var t,r={from:0,to:0,marked:[]},n={from:0,to:0,marked:[]},o=!1;function l(e){o=!(f=!0),"full"==e&&(i.svg&&_(i.svg),i.copyButtons&&_(i.copyButtons),d(i.edit,r.marked,i.classes),d(i.orig,n.marked,i.classes),r.from=r.to=n.from=n.to=0),h(i),i.showDifferences&&(u(i.edit,i.diff,r,DIFF_INSERT,i.classes),u(i.orig,i.diff,n,DIFF_DELETE,i.classes)),"align"==i.mv.options.connect&&y(i),w(i),null!=i.needsScrollSync&&g(i,i.needsScrollSync),f=!1}function a(e){f||(i.dealigned=!0,s(e))}function s(e){f||o||(clearTimeout(t),!0===e&&(o=!0),t=setTimeout(l,!0===e?20:250))}function e(e,t){i.diffOutOfDate||(i.diffOutOfDate=!0,r.from=r.to=n.from=n.to=0),a(t.text.length-1!=t.to.line-t.from.line)}function c(){i.diffOutOfDate=!0,i.dealigned=!0,l("full")}i.edit.on("change",e),i.orig.on("change",e),i.edit.on("swapDoc",c),i.orig.on("swapDoc",c),"align"==i.mv.options.connect&&(p.on(i.edit.state.trackAlignable,"realign",a),p.on(i.orig.state.trackAlignable,"realign",a));return i.edit.on("viewportChange",function(){s(!1)}),i.orig.on("viewportChange",function(){s(!1)}),l(),l}(this),o(this,!0,!1),function(e,t){e.edit.on("scroll",function(){g(e,!0)&&w(e)}),e.orig.on("scroll",function(){g(e,!1)&&w(e),t&&g(t,!0)&&w(t)})}(this,e)},setShowDifferences:function(e){(e=!1!==e)!=this.showDifferences&&(this.showDifferences=e,this.forceUpdate("full"))}});function g(e,t){if(e.diffOutOfDate)return e.lockScroll&&null==e.needsScrollSync&&(e.needsScrollSync=t),!1;if(e.needsScrollSync=null,!e.lockScroll)return!0;var i,r,n=+new Date;if(r=t?(i=e.edit,e.orig):(i=e.orig,e.edit),i.state.scrollSetBy==e&&(i.state.scrollSetAt||0)+250>n)return!1;var o=i.getScrollInfo();if("align"==e.mv.options.connect)m=o.top;else{var l,a,s=.5*o.clientHeight,c=o.top+s,h=i.lineAtHeight(c,"local"),f=function(e,t,i){for(var r,n,o,l,a=0;a<e.length;a++){var s=e[a],c=i?s.editFrom:s.origFrom,h=i?s.editTo:s.origTo;null==n&&(t<c?(n=s.editFrom,l=s.origFrom):t<h&&(n=s.editTo,l=s.origTo)),h<=t?(r=s.editTo,o=s.origTo):c<=t&&(r=s.editFrom,o=s.origFrom)}return{edit:{before:r,after:n},orig:{before:o,after:l}}}(e.chunks,h,t),g=b(i,t?f.edit:f.orig),d=b(r,t?f.orig:f.edit),u=(c-g.top)/(g.bot-g.top),m=d.top-s+u*(d.bot-d.top);if(m>o.top&&(a=o.top/s)<1)m=m*a+o.top*(1-a);else if((l=o.height-o.clientHeight-o.top)<s){var v=r.getScrollInfo();l<v.height-v.clientHeight-m&&(a=l/s)<1&&(m=m*a+(v.height-v.clientHeight-l)*(1-a))}}return r.scrollTo(o.left,m),r.state.scrollSetAt=n,r.state.scrollSetBy=e,!0}function b(e,t){var i=t.after;return null==i&&(i=e.lastLine()+1),{top:e.heightAtLine(t.before||0,"local"),bot:e.heightAtLine(i,"local")}}function o(e,t,i){(e.lockScroll=t)&&0!=i&&g(e,DIFF_INSERT)&&w(e),(t?p.addClass:p.rmClass)(e.lockButton,"CodeMirror-merge-scrolllock-enabled")}function l(e,t,i){for(var r=i.classLocation,n=0;n<r.length;n++)e.removeLineClass(t,r[n],i.chunk),e.removeLineClass(t,r[n],i.start),e.removeLineClass(t,r[n],i.end)}function d(e,t,i){for(var r=0;r<t.length;++r){var n=t[r];n instanceof p.TextMarker?n.clear():n.parent&&l(e,n,i)}t.length=0}function u(e,t,i,r,n){var o=e.getViewport();e.operation(function(){i.from==i.to||20<o.from-i.to||20<i.from-o.to?(d(e,i.marked,n),a(e,t,r,i.marked,o.from,o.to,n),i.from=o.from,i.to=o.to):(o.from<i.from&&(a(e,t,r,i.marked,o.from,i.from,n),i.from=o.from),o.to>i.to&&(a(e,t,r,i.marked,i.to,o.to,n),i.to=o.to))})}function E(e,t,i,r,n,o){for(var l=i.classLocation,a=e.getLineHandle(t),s=0;s<l.length;s++)r&&e.addLineClass(a,l[s],i.chunk),n&&e.addLineClass(a,l[s],i.start),o&&e.addLineClass(a,l[s],i.end);return a}function a(o,e,t,l,a,s,c){var i=A(0,0),r=A(a,0),n=o.clipPos(A(s-1)),h=t==DIFF_DELETE?c.del:c.insert;function f(e,t){for(var i=Math.max(a,e),r=Math.min(s,t),n=i;n<r;++n)l.push(E(o,n,c,!0,n==e,n==t-1));e==t&&i==t&&r==t&&(i?l.push(E(o,i-1,c,!1,!1,!0)):l.push(E(o,i,c,!1,!0,!1)))}for(var g,d,u,m,v,p,k=0,C=!1,b=0;b<e.length;++b){var w=e[b],T=w[0],y=w[1];if(T==DIFF_EQUAL){var F=i.line+(I(e,b)?0:1);j(i,y);var S=i.line+(B(e,b)?1:0);F<S&&(C&&(f(k,F),C=!1),k=S)}else if(C=!0,T==t){var M=j(i,y,!0),L=(p=i,0<((v=r).line-p.line||v.ch-p.ch)?v:p),D=(m=M,((u=n).line-m.line||u.ch-m.ch)<0?u:m);d=D,(g=L).line==d.line&&g.ch==d.ch||l.push(o.markText(L,D,{className:h})),i=M}}C&&f(k,i.line+1)}function w(e){if(e.showDifferences){if(e.svg){_(e.svg);var t=e.gap.offsetWidth;H(e.svg,"width",t,"height",e.gap.offsetHeight)}e.copyButtons&&_(e.copyButtons);for(var i=e.edit.getViewport(),r=e.orig.getViewport(),n=e.mv.wrap.getBoundingClientRect().top,o=n-e.edit.getScrollerElement().getBoundingClientRect().top+e.edit.getScrollInfo().top,l=n-e.orig.getScrollerElement().getBoundingClientRect().top+e.orig.getScrollInfo().top,a=0;a<e.chunks.length;a++){var s=e.chunks[a];s.editFrom<=i.to&&s.editTo>=i.from&&s.origFrom<=r.to&&s.origTo>=r.from&&F(e,s,l,o,t)}}}function T(e,t){for(var i=0,r=0,n=0;n<t.length;n++){var o=t[n];if(o.editTo>e&&o.editFrom<=e)return null;if(o.editFrom>e)break;i=o.editTo,r=o.origTo}return r+(e-i)}function c(e,t,i){for(var r=e.state.trackAlignable,n=e.firstLine(),o=0,l=[],a=0;;a++){for(var s=t[a],c=s?i?s.origFrom:s.editFrom:1e9;o<r.alignable.length;o+=2){var h=r.alignable[o]+1;if(!(h<=n)){if(!(h<=c))break;l.push(h)}}if(!s)break;l.push(n=i?s.origTo:s.editTo)}return l}function m(e,t,i,r){var n=0,o=0,l=0,a=0;e:for(;;n++){var s=e[n],c=t[o];if(!s&&null==c)break;for(var h=s?s[0]:1e9,f=null==c?1e9:c;l<i.length;){var g=i[l];if(g.origFrom<=f&&g.origTo>f){o++,n--;continue e}if(g.editTo>h){if(g.editFrom<=h)continue e;break}a+=g.origTo-g.origFrom-(g.editTo-g.editFrom),l++}if(h==f-a)s[r]=f,o++;else if(h<f-a)s[r]=h+a;else{var d=[f-a,null,null];d[r]=f,e.splice(n,0,d),o++}}}function y(e,t){if(e.dealigned||t){if(!e.orig.curOp)return e.orig.operation(function(){y(e,t)});e.dealigned=!1;var i=e.mv.left==e?e.mv.right:e.mv.left;i&&(h(i),i.dealigned=!1);for(var r=function(e,t){var i=c(e.edit,e.chunks,!1),r=[];if(t)for(var n=0,o=0;n<t.chunks.length;n++){for(var l=t.chunks[n].editTo;o<i.length&&i[o]<l;)o++;o!=i.length&&i[o]==l||i.splice(o++,0,l)}for(n=0;n<i.length;n++)r.push([i[n],null,null]);return m(r,c(e.orig,e.chunks,!0),e.chunks,1),t&&m(r,c(t.orig,t.chunks,!0),t.chunks,2),r}(e,i),n=e.mv.aligners,o=0;o<n.length;o++)n[o].clear();n.length=0;var l=[e.edit,e.orig],a=[];i&&l.push(i.orig);for(o=0;o<l.length;o++)a.push(l[o].getScrollInfo().top);for(var s=0;s<r.length;s++)v(l,r[s],n);for(o=0;o<l.length;o++)l[o].scrollTo(null,a[o])}}function v(e,t,i){for(var r=0,n=[],o=0;o<e.length;o++)if(null!=t[o]){var l=e[o].heightAtLine(t[o],"local");n[o]=l,r=Math.max(r,l)}for(o=0;o<e.length;o++)if(null!=t[o]){var a=r-n[o];1<a&&i.push(s(e[o],t[o],a))}}function s(e,t,i){var r=!0;t>e.lastLine()&&(t--,r=!1);var n=document.createElement("div");return n.className="CodeMirror-merge-spacer",n.style.height=i+"px",n.style.minWidth="1px",e.addLineWidget(t,n,{height:i,above:r,mergeSpacer:!0,handleMouseEvents:!0})}function F(e,t,i,r,n){var o="left"==e.type,l=e.orig.heightAtLine(t.origFrom,"local",!0)-i;if(e.svg){var a=l,s=e.edit.heightAtLine(t.editFrom,"local",!0)-r;if(o){var c=a;a=s,s=c}var h=e.orig.heightAtLine(t.origTo,"local",!0)-i,f=e.edit.heightAtLine(t.editTo,"local",!0)-r;if(o){c=h;h=f,f=c}var g=" C "+n/2+" "+s+" "+n/2+" "+a+" "+(n+2)+" "+a,d=" C "+n/2+" "+h+" "+n/2+" "+f+" -1 "+f;H(e.svg.appendChild(document.createElementNS(k,"path")),"d","M -1 "+s+g+" L "+(n+2)+" "+h+d+" z","class",e.classes.connect)}if(e.copyButtons){var u=e.copyButtons.appendChild(V("div","left"==e.type?"⇝":"⇜","CodeMirror-merge-copy")),m=e.mv.options.allowEditingOriginals;if(u.title=e.edit.phrase(m?"Push to left":"Revert chunk"),u.chunk=t,u.style.top=(t.origTo>t.origFrom?l:e.edit.heightAtLine(t.editFrom,"local")-r)+"px",m){var v=e.edit.heightAtLine(t.editFrom,"local")-r,p=e.copyButtons.appendChild(V("div","right"==e.type?"⇝":"⇜","CodeMirror-merge-copy-reverse"));p.title="Push to right",p.chunk={editFrom:t.origFrom,editTo:t.origTo,origFrom:t.editFrom,origTo:t.editTo},p.style.top=v+"px","right"==e.type?p.style.left="2px":p.style.right="2px"}}}function S(e,t,i,r){if(!e.diffOutOfDate){var n=r.origTo>i.lastLine()?A(r.origFrom-1):A(r.origFrom,0),o=A(r.origTo,0),l=r.editTo>t.lastLine()?A(r.editFrom-1):A(r.editFrom,0),a=A(r.editTo,0),s=e.mv.options.revertChunk;s?s(e.mv,i,n,o,t,l,a):t.replaceRange(i.getRange(n,o),l,a)}}var M,L=p.MergeView=function(e,t){if(!(this instanceof L))return new L(e,t);var i=(this.options=t).origLeft,r=null==t.origRight?t.orig:t.origRight,n=null!=i,o=null!=r,l=1+(n?1:0)+(o?1:0),a=[],s=this.left=null,c=this.right=null,h=this;if(n){s=this.left=new C(this,"left");var f=V("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");a.push(f),a.push(D(s))}var g=V("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");if(a.push(g),o){c=this.right=new C(this,"right"),a.push(D(c));var d=V("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");a.push(d)}(o?d:g).className+=" CodeMirror-merge-pane-rightmost",a.push(V("div",null,null,"height: 0; clear: both;"));var u=this.wrap=e.appendChild(V("div",a,"CodeMirror-merge CodeMirror-merge-"+l+"pane"));this.edit=p(g,P(t)),s&&s.init(f,i,t),c&&c.init(d,r,t),t.collapseIdentical&&this.editor().operation(function(){!function(e,t){"number"!=typeof t&&(t=2);for(var i=[],r=e.editor(),n=r.firstLine(),o=n,l=r.lastLine();o<=l;o++)i.push(!0);e.left&&W(e.left,t,n,i);e.right&&W(e.right,t,n,i);for(var a=0;a<i.length;a++)if(i[a]){for(var s=a+n,c=1;a<i.length-1&&i[a+1];a++,c++);if(t<c){var h=[{line:s,cm:r}];e.left&&h.push({line:T(s,e.left.chunks),cm:e.left.orig}),e.right&&h.push({line:T(s,e.right.chunks),cm:e.right.orig});var f=R(c,h);e.options.onCollapse&&e.options.onCollapse(e,s,c,f)}}}(h,t.collapseIdentical)}),"align"==t.connect&&(this.aligners=[],y(this.left||this.right,!0)),s&&s.registerEvents(c),c&&c.registerEvents(s);function m(){s&&w(s),c&&w(c)}p.on(window,"resize",m);var v=setInterval(function(){for(var e=u.parentNode;e&&e!=document.body;e=e.parentNode);e||(clearInterval(v),p.off(window,"resize",m))},5e3)};function D(i){var e=i.lockButton=V("div",null,"CodeMirror-merge-scrolllock"),t=V("div",[e],"CodeMirror-merge-scrolllock-wrap");p.on(e,"click",function(){o(i,!i.lockScroll)});var r=[t];if(!1!==i.mv.options.revertButtons&&(i.copyButtons=V("div",null,"CodeMirror-merge-copybuttons-"+i.type),p.on(i.copyButtons,"click",function(e){var t=e.target||e.srcElement;t.chunk&&("CodeMirror-merge-copy-reverse"!=t.className?S(i,i.edit,i.orig,t.chunk):S(i,i.orig,i.edit,t.chunk))}),r.unshift(i.copyButtons)),"align"!=i.mv.options.connect){var n=document.createElementNS&&document.createElementNS(k,"svg");n&&!n.createSVGRect&&(n=null),(i.svg=n)&&r.push(n)}return i.gap=V("div",r,"CodeMirror-merge-gap")}function n(e){return"string"==typeof e?e:e.getValue()}function O(e,t,i){for(var r=(M=M||new diff_match_patch).diff_main(e,t),n=0;n<r.length;++n){var o=r[n];(i?/[^ \t]/.test(o[1]):o[1])?n&&r[n-1][0]==o[0]&&(r.splice(n--,1),r[n][1]+=o[1]):r.splice(n--,1)}return r}function x(e){var t=[];if(!e.length)return t;for(var i=0,r=0,n=A(0,0),o=A(0,0),l=0;l<e.length;++l){var a=e[l],s=a[0];if(s==DIFF_EQUAL){var c=!I(e,l)||n.line<i||o.line<r?1:0,h=n.line+c,f=o.line+c;j(n,a[1],null,o);var g=B(e,l)?1:0,d=n.line+g,u=o.line+g;h<d&&(l&&t.push({origFrom:r,origTo:f,editFrom:i,editTo:h}),i=d,r=u)}else j(s==DIFF_INSERT?n:o,a[1])}return(i<=n.line||r<=o.line)&&t.push({origFrom:r,origTo:o.line+1,editFrom:i,editTo:n.line+1}),t}function B(e,t){if(t==e.length-1)return!0;var i=e[t+1][1];return!(1==i.length&&t<e.length-2||10!=i.charCodeAt(0))&&(t==e.length-2||(1<(i=e[t+2][1]).length||t==e.length-3)&&10==i.charCodeAt(0))}function I(e,t){if(0==t)return!0;var i=e[t-1][1];return 10==i.charCodeAt(i.length-1)&&(1==t||10==(i=e[t-2][1]).charCodeAt(i.length-1))}function N(e,t,i){e.addLineClass(t,"wrap","CodeMirror-merge-collapsed-line");var r=document.createElement("span");r.className="CodeMirror-merge-collapsed-widget",r.title=e.phrase("Identical text collapsed. Click to expand.");var n=e.markText(A(t,0),A(i-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:r,clearOnEnter:!0});function o(){n.clear(),e.removeLineClass(t,"wrap","CodeMirror-merge-collapsed-line")}return n.explicitlyCleared&&o(),p.on(r,"click",o),n.on("clear",o),p.on(r,"click",o),{mark:n,clear:o}}function R(e,t){var i=[];function r(){for(var e=0;e<i.length;e++)i[e].clear()}for(var n=0;n<t.length;n++){var o=t[n],l=N(o.cm,o.line,o.line+e);i.push(l),l.mark.on("clear",r)}return i[0].mark}function W(e,t,i,r){for(var n=0;n<e.chunks.length;n++)for(var o=e.chunks[n],l=o.editFrom-t;l<o.editTo+t;l++){var a=l+i;0<=a&&a<r.length&&(r[a]=!1)}}function V(e,t,i,r){var n=document.createElement(e);if(i&&(n.className=i),r&&(n.style.cssText=r),"string"==typeof t)n.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)n.appendChild(t[o]);return n}function _(e){for(var t=e.childNodes.length;0<t;--t)e.removeChild(e.firstChild)}function H(e){for(var t=1;t<arguments.length;t+=2)e.setAttribute(arguments[t],arguments[t+1])}function P(e,t){for(var i in t=t||{},e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function j(e,t,i,r){for(var n=i?A(e.line,e.ch):e,o=0;;){var l=t.indexOf("\n",o);if(-1==l)break;++n.line,r&&++r.line,o=l+1}return n.ch=(o?0:n.ch)+(t.length-o),r&&(r.ch=(o?0:r.ch)+(t.length-o)),n}L.prototype={constructor:L,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(e){this.right&&this.right.setShowDifferences(e),this.left&&this.left.setShowDifferences(e)},rightChunks:function(){if(this.right)return h(this.right),this.right.chunks},leftChunks:function(){if(this.left)return h(this.left),this.left.chunks}};var r=1,U=2,z=4;function Q(e){this.cm=e,this.alignable=[],this.height=e.doc.height;var l=this;e.on("markerAdded",function(e,t){if(t.collapsed){var i=t.find(1);null!=i&&l.set(i.line,z)}}),e.on("markerCleared",function(e,t,i,r){null!=r&&t.collapsed&&l.check(r,z,l.hasMarker)}),e.on("markerChanged",this.signal.bind(this)),e.on("lineWidgetAdded",function(e,t,i){t.mergeSpacer||(t.above?l.set(i-1,U):l.set(i,r))}),e.on("lineWidgetCleared",function(e,t,i){t.mergeSpacer||(t.above?l.check(i-1,U,l.hasWidgetBelow):l.check(i,r,l.hasWidget))}),e.on("lineWidgetChanged",this.signal.bind(this)),e.on("change",function(e,t){var i=t.from.line,r=t.to.line-t.from.line,n=t.text.length-1,o=i+n;(r||n)&&l.map(i,r,n),l.check(o,z,l.hasMarker),(r||n)&&l.check(t.from.line,z,l.hasMarker)}),e.on("viewportChange",function(){l.cm.doc.height!=l.height&&l.signal()})}function q(e,t,i){for(var r=e.length-1;0<=r;r--){var n=e[r],o=(i?n.origTo:n.editTo)-1;if(o<t)return o}}function G(e,t,i){for(var r=0;r<e.length;r++){var n=e[r],o=i?n.origFrom:n.editFrom;if(t<o)return o}}function t(e,t){var i=null,r=e.state.diffViews,n=e.getCursor().line;if(r)for(var o=0;o<r.length;o++){var l=r[o],a=e==l.orig;h(l);var s=t<0?q(l.chunks,n,a):G(l.chunks,n,a);null==s||null!=i&&!(t<0?i<s:s<i)||(i=s)}if(null==i)return p.Pass;e.setCursor(i,0)}Q.prototype={signal:function(){p.signal(this,"realign"),this.height=this.cm.doc.height},set:function(e,t){for(var i=-1;i<this.alignable.length;i+=2){var r=this.alignable[i]-e;if(0==r){if((this.alignable[i+1]&t)==t)return;return this.alignable[i+1]|=t,void this.signal()}if(0<r)break}this.signal(),this.alignable.splice(i,0,e,t)},find:function(e){for(var t=0;t<this.alignable.length;t+=2)if(this.alignable[t]==e)return t;return-1},check:function(e,t,i){var r=this.find(e);if(-1!=r&&this.alignable[r+1]&t&&!i.call(this,e)){this.signal();var n=this.alignable[r+1]&~t;n?this.alignable[r+1]=n:this.alignable.splice(r,2)}},hasMarker:function(e){var t=this.cm.getLineHandle(e);if(t.markedSpans)for(var i=0;i<t.markedSpans.length;i++)if(t.markedSpans[i].marker.collapsed&&null!=t.markedSpans[i].to)return!0;return!1},hasWidget:function(e){var t=this.cm.getLineHandle(e);if(t.widgets)for(var i=0;i<t.widgets.length;i++)if(!t.widgets[i].above&&!t.widgets[i].mergeSpacer)return!0;return!1},hasWidgetBelow:function(e){if(e==this.cm.lastLine())return!1;var t=this.cm.getLineHandle(e+1);if(t.widgets)for(var i=0;i<t.widgets.length;i++)if(t.widgets[i].above&&!t.widgets[i].mergeSpacer)return!0;return!1},map:function(e,t,i){for(var r=i-t,n=e+t,o=-1,l=-1,a=0;a<this.alignable.length;a+=2){var s=this.alignable[a];s==e&&this.alignable[a+1]&U&&(o=a),s==n&&this.alignable[a+1]&U&&(l=a),s<=e||(s<n?this.alignable.splice(a--,2):this.alignable[a]+=r)}if(-1<o){var c=this.alignable[o+1];c==U?this.alignable.splice(o,2):this.alignable[o+1]=c&~U}-1<l&&i&&this.set(e+i,U)}},p.commands.goNextDiff=function(e){return t(e,1)},p.commands.goPrevDiff=function(e){return t(e,-1)}});