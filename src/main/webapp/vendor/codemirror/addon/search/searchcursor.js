!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(i){"use strict";var p,x,L=i.Pos;function m(t,n){for(var e=function(t){var n=t.flags;return null!=n?n:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}(t),r=e,i=0;i<n.length;i++)-1==r.indexOf(n.charAt(i))&&(r+=n.charAt(i));return e==r?t:new RegExp(t.source,r)}function v(t,n,e){n=m(n,"g");for(var r=e.line,i=e.ch,o=t.lastLine();r<=o;r++,i=0){n.lastIndex=i;var l=t.getLine(r),h=n.exec(l);if(h)return{from:L(r,h.index),to:L(r,h.index+h[0].length),match:h}}}function d(t,n){for(var e,r=0;;){n.lastIndex=r;var i=n.exec(t);if(!i)return e;if((r=(e=i).index+(e[0].length||1))==t.length)return e}}function C(t,n,e,r){if(t.length==n.length)return e;for(var i=0,o=e+Math.max(0,t.length-n.length);;){if(i==o)return i;var l=i+o>>1,h=r(t.slice(0,l)).length;if(h==e)return l;e<h?o=l:i=1+l}}function r(e,r,t,n){var i;this.atOccurrence=!1,this.doc=e,t=t?e.clipPos(t):L(0,0),this.pos={from:t,to:t},"object"==typeof n?i=n.caseFold:(i=n,n=null),"string"==typeof r?(null==i&&(i=!1),this.matches=function(t,n){return(t?function(t,n,e,r){if(!n.length)return null;var i=r?p:x,o=i(n).split(/\r|\n\r?/);t:for(var l=e.line,h=e.ch,s=t.firstLine()-1+o.length;s<=l;l--,h=-1){var c=t.getLine(l);-1<h&&(c=c.slice(0,h));var f=i(c);if(1==o.length){var u=f.lastIndexOf(o[0]);if(-1==u)continue t;return{from:L(l,C(c,f,u,i)),to:L(l,C(c,f,u+o[0].length,i))}}var a=o[o.length-1];if(f.slice(0,a.length)==a){var g=1;for(e=l-o.length+1;g<o.length-1;g++)if(i(t.getLine(e+g))!=o[g])continue t;var m=t.getLine(l+1-o.length),v=i(m);if(v.slice(v.length-o[0].length)==o[0])return{from:L(l+1-o.length,C(m,v,m.length-o[0].length,i)),to:L(l,C(c,f,a.length,i))}}}}:function(t,n,e,r){if(!n.length)return null;var i=r?p:x,o=i(n).split(/\r|\n\r?/);t:for(var l=e.line,h=e.ch,s=t.lastLine()+1-o.length;l<=s;l++,h=0){var c=t.getLine(l).slice(h),f=i(c);if(1==o.length){var u=f.indexOf(o[0]);if(-1==u)continue t;e=C(c,f,u,i)+h;return{from:L(l,C(c,f,u,i)+h),to:L(l,C(c,f,u+o[0].length,i)+h)}}var a=f.length-o[0].length;if(f.slice(a)==o[0]){for(var g=1;g<o.length-1;g++)if(i(t.getLine(l+g))!=o[g])continue t;var m=t.getLine(l+o.length-1),v=i(m),d=o[o.length-1];if(v.slice(0,d.length)==d)return{from:L(l,C(c,f,a,i)+h),to:L(l+o.length-1,C(m,v,d.length,i))}}}})(e,r,n,i)}):(r=m(r,"gm"),n&&!1===n.multiline?this.matches=function(t,n){return(t?function(t,n,e){n=m(n,"g");for(var r=e.line,i=e.ch,o=t.firstLine();o<=r;r--,i=-1){var l=t.getLine(r);-1<i&&(l=l.slice(0,i));var h=d(l,n);if(h)return{from:L(r,h.index),to:L(r,h.index+h[0].length),match:h}}}:v)(e,r,n)}:this.matches=function(t,n){return(t?function(t,n,e){n=m(n,"gm");for(var r,i=1,o=e.line,l=t.firstLine();l<=o;){for(var h=0;h<i;h++){var s=t.getLine(o--);r=null==r?s.slice(0,e.ch):s+"\n"+r}i*=2;var c=d(r,n);if(c){var f=r.slice(0,c.index).split("\n"),u=c[0].split("\n"),a=o+f.length,g=f[f.length-1].length;return{from:L(a,g),to:L(a+u.length-1,1==u.length?g+u[0].length:u[u.length-1].length),match:c}}}}:function(t,n,e){if(!function(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}(n))return v(t,n,e);n=m(n,"gm");for(var r,i=1,o=e.line,l=t.lastLine();o<=l;){for(var h=0;h<i&&!(l<o);h++){var s=t.getLine(o++);r=null==r?s:r+"\n"+s}i*=2,n.lastIndex=e.ch;var c=n.exec(r);if(c){var f=r.slice(0,c.index).split("\n"),u=c[0].split("\n"),a=e.line+f.length-1,g=f[f.length-1].length;return{from:L(a,g),to:L(a+u.length-1,1==u.length?g+u[0].length:u[u.length-1].length),match:c}}}})(e,r,n)})}x=String.prototype.normalize?(p=function(t){return t.normalize("NFD").toLowerCase()},function(t){return t.normalize("NFD")}):(p=function(t){return t.toLowerCase()},function(t){return t}),r.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){for(var n=this.matches(t,this.doc.clipPos(t?this.pos.from:this.pos.to));n&&0==i.cmpPos(n.from,n.to);)t?n.from.ch?n.from=L(n.from.line,n.from.ch-1):n=n.from.line==this.doc.firstLine()?null:this.matches(t,this.doc.clipPos(L(n.from.line-1))):n.to.ch<this.doc.getLine(n.to.line).length?n.to=L(n.to.line,n.to.ch+1):n=n.to.line==this.doc.lastLine()?null:this.matches(t,L(n.to.line+1,0));if(n)return this.pos=n,this.atOccurrence=!0,this.pos.match||!0;var e=L(t?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:e,to:e},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t,n){if(this.atOccurrence){var e=i.splitLines(t);this.doc.replaceRange(e,this.pos.from,this.pos.to,n),this.pos.to=L(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0))}}},i.defineExtension("getSearchCursor",function(t,n,e){return new r(this.doc,t,n,e)}),i.defineDocExtension("getSearchCursor",function(t,n,e){return new r(this,t,n,e)}),i.defineExtension("selectMatches",function(t,n){for(var e=[],r=this.getSearchCursor(t,this.getCursor("from"),n);r.findNext()&&!(0<i.cmpPos(r.to(),this.getCursor("to")));)e.push({anchor:r.from(),head:r.to()});e.length&&this.setSelections(e,0)})});