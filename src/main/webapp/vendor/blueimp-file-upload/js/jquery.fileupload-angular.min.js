!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","angular","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):"object"==typeof exports?e(require("jquery"),require("angular"),require("./jquery.fileupload-image"),require("./jquery.fileupload-audio"),require("./jquery.fileupload-video"),require("./jquery.fileupload-validate")):e()}(function(){"use strict";angular.module("blueimp.fileupload",[]).provider("fileUpload",function(){function e(e){angular.element(this).fileupload("option","scope").$evalAsync(e)}function t(e,r){var o=r.files,n=o[0];angular.forEach(o,function(e,o){e._index=o,e.$state=function(){return r.state()},e.$processing=function(){return r.processing()},e.$progress=function(){return r.progress()},e.$response=function(){return r.response()}}),n.$submit=function(){if(!n.error)return r.submit()},n.$cancel=function(){return r.abort()}}var o;o=this.defaults={handleResponse:function(e,o){var r=o.result&&o.result.files;r?o.scope.replace(o.files,r):!o.errorThrown&&"error"!==o.textStatus||(o.files[0].error=o.errorThrown||o.textStatus)},add:function(e,o){if(e.isDefaultPrevented())return!1;var r=o.scope,n=[];angular.forEach(o.files,function(e){n.push(e)}),r.$parent.$applyAsync(function(){t(0,o);var e=r.option("prependFiles")?"unshift":"push";Array.prototype[e].apply(r.queue,o.files)}),o.process(function(){return r.process(o)}).always(function(){r.$parent.$applyAsync(function(){t(0,o),r.replace(n,o.files)})}).then(function(){(r.option("autoUpload")||o.autoUpload)&&!1!==o.autoUpload&&o.submit()})},done:function(e,o){if(e.isDefaultPrevented())return!1;var r=this;o.scope.$apply(function(){o.handleResponse.call(r,e,o)})},fail:function(e,o){if(e.isDefaultPrevented())return!1;var r=this,n=o.scope;"abort"!==o.errorThrown?n.$apply(function(){o.handleResponse.call(r,e,o)}):n.clear(o.files)},stop:e,processstart:e,processstop:e,getNumberOfFiles:function(){var e=this.scope;return e.queue.length-e.processing()},dataType:"json",autoUpload:!1},this.$get=[function(){return{defaults:o}}]}).provider("formatFileSizeFilter",function(){var l={units:[{size:1e9,suffix:" GB"},{size:1e6,suffix:" MB"},{size:1e3,suffix:" KB"}]};this.defaults=l,this.$get=function(){return function(e){if(!angular.isNumber(e))return"";for(var o,r,n=!0,t=0;n;){if(o=(n=l.units[t]).prefix||"",r=n.suffix||"",t===l.units.length-1||e>=n.size)return o+(e/n.size).toFixed(2)+r;t+=1}}}}).controller("FileUploadController",["$scope","$element","$attrs","$window","fileUpload","$q",function(r,n,e,o,t,l){var i={progress:function(){return n.fileupload("progress")},active:function(){return n.fileupload("active")},option:function(e,o){if(1===arguments.length)return n.fileupload("option",e);n.fileupload("option",e,o)},add:function(e){return n.fileupload("add",e)},send:function(e){return n.fileupload("send",e)},process:function(e){return n.fileupload("process",e)},processing:function(e){return n.fileupload("processing",e)}};r.disabled=!o.jQuery.support.fileInput,r.queue=r.queue||[],r.clear=function(e){var o=this.queue,r=o.length,n=e,t=1;for(angular.isArray(e)&&(n=e[0],t=e.length);r;)if(o[r-=1]===n)return o.splice(r,t)},r.replace=function(e,o){var r,n,t=this.queue,l=e[0];for(r=0;r<t.length;r+=1)if(t[r]===l){for(n=0;n<o.length;n+=1)t[r+n]=o[n];return}},r.applyOnQueue=function(e){var o,r,n=this.queue.slice(0),t=[];for(o=0;o<n.length;o+=1)(r=n[o])[e]&&t.push(r[e]());return l.all(t)},r.submit=function(){return this.applyOnQueue("$submit")},r.cancel=function(){return this.applyOnQueue("$cancel")},angular.extend(r,i),n.fileupload(angular.extend({scope:r},t.defaults)).on("fileuploadadd",function(e,o){o.scope=r}).on("fileuploadfail",function(e,o){if("abort"!==o.errorThrown&&o.dataType&&o.dataType.indexOf("json")===o.dataType.length-4)try{o.result=angular.fromJson(o.jqXHR.responseText)}catch(e){}}).on(["fileuploadadd","fileuploadsubmit","fileuploadsend","fileuploaddone","fileuploadfail","fileuploadalways","fileuploadprogress","fileuploadprogressall","fileuploadstart","fileuploadstop","fileuploadchange","fileuploadpaste","fileuploaddrop","fileuploaddragover","fileuploadchunkbeforesend","fileuploadchunksend","fileuploadchunkdone","fileuploadchunkfail","fileuploadchunkalways","fileuploadprocessstart","fileuploadprocess","fileuploadprocessdone","fileuploadprocessfail","fileuploadprocessalways","fileuploadprocessstop"].join(" "),function(e,o){r.$parent.$applyAsync(function(){r.$emit(e.type,o).defaultPrevented&&e.preventDefault()})}).on("remove",function(){var e;for(e in i)i.hasOwnProperty(e)&&delete r[e]}),r.$watch(e.fileUpload,function(e){e&&n.fileupload("option",e)})}]).controller("FileUploadProgressController",["$scope","$attrs","$parse",function(o,e,r){function n(){var e=t(o);e&&e.total&&(o.num=Math.floor(e.loaded/e.total*100))}var t=r(e.fileUploadProgress);n(),o.$watch(e.fileUploadProgress+".loaded",function(e,o){e!==o&&n()})}]).controller("FileUploadPreviewController",["$scope","$element","$attrs",function(e,o,r){e.$watch(r.fileUploadPreview+".preview",function(e){o.empty(),e&&o.append(e)})}]).directive("fileUpload",function(){return{controller:"FileUploadController",scope:!0}}).directive("fileUploadProgress",function(){return{controller:"FileUploadProgressController",scope:!0}}).directive("fileUploadPreview",function(){return{controller:"FileUploadPreviewController"}}).directive("download",function(){return function(e,o){o.on("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",o.prop("download"),o.prop("href")].join(":"))}catch(e){}})}})});